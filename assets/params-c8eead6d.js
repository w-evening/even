import{d as X,h as _,o as Y,k as y,a as e,l as t,n as s,q as r,p as v,F as B,s as i,t as $,v as j,x as c,aB as F,y as I,ax as Z,B as ee,z as te,A as ae,C as M}from"./index-4b809c19.js";import{a as ne,b as P,c as le,d as oe}from"./goods-04134f46.js";import{T as se,P as q,_ as ue,a as re,b as _e}from"./index-24fe8965.js";import{I as ie}from"./index-2eaeb946.js";import{_ as de}from"./index-e9441ad8.js";import{E as L,_ as pe}from"./index-abdb43a4.js";import{D as G}from"./DeleteOutlined-67fd5099.js";import{_ as ce}from"./index-39636341.js";import{_ as me}from"./index-36347180.js";import"./useFlexGapSupport-86488050.js";const $e=X({__name:"params",setup(fe){const R=_("1");let k=_(!0);const K=[],d=_([]),H=()=>{if(Object.keys(d.value).length!==3){I.error("分类必须为三级分类！"),d.value=[],k.value=!0;return}k.value=!1;const m=K.filter(u=>JSON.stringify(u).includes(d.value[2]))[0].children.filter(u=>JSON.stringify(u).includes(d.value[2]))[0].children.filter(u=>JSON.stringify(u).includes(d.value[2]));P(m[0].cat_id,{sel:"only"}).then(u=>{g.value=[...g.value,...u.data]}),P(m[0].cat_id,{sel:"many"}).then(u=>{b.value=[...b.value,...u.data]})};Y(async()=>{(await ne()).data.forEach(n=>{K.push(n)})});const E=[{title:"#ID",dataIndex:"attr_id",key:"attr_id"},{title:"参数名",dataIndex:"attr_name",key:"attr_name"},{title:"操作",dataIndex:"operation",key:"operation"}],b=_([]),g=_([]),S=(o,n)=>{c.state.attr_vals=n.attr_vals.split(" ")},N=_(),x=_(!1),p=_(""),T=(o,n)=>{oe(o.cat_id,o.attr_id,{attr_name:o.attr_name,attr_sel:o.attr_sel,attr_vals:n}).then(m=>{I.success(m.meta.msg)})},V=()=>{x.value=!0,Z(()=>{N.value.focus()})},h=o=>{p.value&&c.state.attr_vals.indexOf(p.value)===-1&&(c.state.attr_vals=[...c.state.attr_vals,p.value],x.value=!1,le(o.cat_id,o.attr_id,{attr_name:o.attr_name,attr_sel:o.attr_sel,attr_vals:c.state.attr_vals.join(" ")}).then(n=>{I.success(n.meta.msg)}))};return(o,n)=>{const m=ue,u=re,Q=de,f=ee,w=te,A=ae,C=ce,D=ie,U=me,z=pe,J=_e,W=se;return s(),y("div",null,[e(m,{message:"只允许为三级分类设置属性！！！",type:"success","show-icon":"",closable:"",class:"mb-20px"}),e(Q,{label:"选择分类：",name:"cate",class:"w-300px"},{default:t(()=>[e(u,{value:d.value,"onUpdate:value":n[0]||(n[0]=a=>d.value=a),options:K,allowClear:!1,fieldNames:{label:"cat_name",value:"cat_name",children:"children"},name:"cate",onChange:H,placeholder:"请选择分类"},null,8,["value"])]),_:1}),e(W,{activeKey:R.value,"onUpdate:activeKey":n[3]||(n[3]=a=>R.value=a)},{default:t(()=>[e(J,{key:"1",tab:"动态属性"},{default:t(()=>[e(f,{type:"primary",disabled:r(k)},{default:t(()=>[v("添加属性")]),_:1},8,["disabled"]),e(z,{"row-key":a=>a.attr_id,columns:E,"data-source":b.value,bordered:"",onExpand:S},{bodyCell:t(({column:a,record:l,text:O})=>[a.key==="operation"?(s(),y(B,{key:0},[e(w,{title:"编辑"},{default:t(()=>[e(f,{type:"primary"},{default:t(()=>[e(r(L))]),_:1})]),_:1}),b.value.length?(s(),i(A,{key:0,title:"确定删除?"},{default:t(()=>[e(w,{title:"删除"},{default:t(()=>[e(f,{type:"primary",danger:""},{default:t(()=>[e(r(G))]),_:1})]),_:1})]),_:1})):$("",!0)],64)):$("",!0)]),expandedRowRender:t(({record:a})=>[e(U,null,{default:t(()=>[(s(!0),y(B,null,j(r(c).state.attr_vals,l=>(s(),i(C,{key:l,color:"#2db7f5",closable:"",onClose:O=>T(a,l)},{default:t(()=>[v(M(l),1)]),_:2},1032,["onClose"]))),128)),x.value?(s(),i(D,{key:0,ref_key:"inputRef",ref:N,value:p.value,"onUpdate:value":n[1]||(n[1]=l=>p.value=l),type:"text",size:"small",style:{width:"78px"},onBlur:l=>h(a),onKeyup:F(l=>h(a),["enter"])},null,8,["value","onBlur","onKeyup"])):(s(),i(C,{key:1,style:{background:"#fff"},onClick:V},{default:t(()=>[e(r(q)),v(" New Tag ")]),_:1}))]),_:2},1024)]),_:1},8,["row-key","data-source"])]),_:1}),e(J,{key:"2",tab:"静态属性"},{default:t(()=>[e(f,{type:"primary",disabled:r(k)},{default:t(()=>[v("添加参数")]),_:1},8,["disabled"]),e(z,{"row-key":a=>a.attr_id,columns:E,"data-source":g.value,bordered:"",onExpand:S},{bodyCell:t(({column:a,record:l,text:O})=>[a.key==="operation"?(s(),y(B,{key:0},[e(w,{title:"编辑"},{default:t(()=>[e(f,{type:"primary"},{default:t(()=>[e(r(L))]),_:1})]),_:1}),g.value.length?(s(),i(A,{key:0,title:"确定删除?"},{default:t(()=>[e(w,{title:"删除"},{default:t(()=>[e(f,{type:"primary",danger:""},{default:t(()=>[e(r(G))]),_:1})]),_:1})]),_:1})):$("",!0)],64)):$("",!0)]),expandedRowRender:t(({record:a})=>[e(U,null,{default:t(()=>[(s(!0),y(B,null,j(r(c).state.attr_vals,l=>(s(),i(C,{key:l,color:"#2db7f5",closable:"",onClose:O=>T(a,l)},{default:t(()=>[v(M(l),1)]),_:2},1032,["onClose"]))),128)),x.value?(s(),i(D,{key:0,ref_key:"inputRef",ref:N,value:p.value,"onUpdate:value":n[2]||(n[2]=l=>p.value=l),type:"text",size:"small",style:{width:"78px"},onBlur:l=>h(a),onKeyup:F(l=>h(a),["enter"])},null,8,["value","onBlur","onKeyup"])):(s(),i(C,{key:1,style:{background:"#fff"},onClick:V},{default:t(()=>[e(r(q)),v(" New Tag ")]),_:1}))]),_:2},1024)]),_:1},8,["row-key","data-source"])]),_:1})]),_:1},8,["activeKey"])])}}});export{$e as default};
